<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forgot Password - Onboarding Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <header class="bg-blue-600 text-white text-center py-8 shadow-md">
        <h1 class="text-4xl font-light">Forgot Password</h1>
        <p class="opacity-90 mt-2">Enter your email to receive a reset link</p>
    </header>

    <div class="container mx-auto mt-8 max-w-md">
        <div class="bg-white p-8 rounded-lg shadow-md">
            <form id="forgotForm">
                <div class="mb-6">
                    <label for="email" class="block text-gray-700 text-sm font-bold mb-2">Email Address</label>
                    <input type="email" id="email" placeholder="Enter your email" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    <div class="text-red-500 mt-2 text-sm" id="emailError" style="display: none;"></div>
                </div>

                <button type="submit" id="submitBtn" class="w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">Send Reset Link</button>
            </form>

            <div id="loading" class="text-center mt-4 text-gray-600" style="display: none;">Sending reset email...</div>
            <div id="globalError" class="text-red-500 mt-4 text-sm" style="display: none;"></div>
            <div id="globalSuccess" class="text-green-500 mt-4 text-sm" style="display: none;"></div>

            <a href="login.html" class="block text-center mt-4 text-blue-500 hover:underline">‚Üê Back to Login</a>
        </div>
    </div>

    <script>
        // Inline forgotPassword function
        async function forgotPassword(email) {
            const baseUrl = 'https://onboardingservice-812204315267.europe-west1.run.app/api';
            const url = `${baseUrl}/Auth/forgot-password`;
            const headers = { 'accept': 'text/plain', 'Content-Type': 'application/json' };
            const body = JSON.stringify({ email });
            console.log('Forgot password payload:', body);

            try {
                const response = await fetch(url, { method: 'POST', headers, body });
                if (response.status !== 200) {
                    throw new Error(`Failed to send password reset email: ${response.status}. ${await response.text()}`);
                }
                return await response.json();
            } catch (e) {
                throw new Error(`Network error during forgot password request: ${e.message}`);
            }
        }

        // Handle form submission
        document.getElementById('forgotForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const submitBtn = document.getElementById('submitBtn');
            const loading = document.getElementById('loading');
            const globalError = document.getElementById('globalError');
            const globalSuccess = document.getElementById('globalSuccess');

            // Clear previous messages
            globalError.style.display = 'none';
            globalSuccess.style.display = 'none';
            document.getElementById('emailError').style.display = 'none';

            const email = document.getElementById('email').value.trim();

            // Basic validation
            if (!email) {
                document.getElementById('emailError').textContent = 'Please enter your email address.';
                document.getElementById('emailError').style.display = 'block';
                return;
            }

            // Disable button and show loading
            submitBtn.disabled = true;
            loading.style.display = 'block';

            try {
                const response = await forgotPassword(email);
                globalSuccess.textContent = 'Password reset email sent! Check your inbox.';
                globalSuccess.style.display = 'block';
                document.getElementById('forgotForm').reset();
            } catch (err) {
                globalError.textContent = err.message;
                globalError.style.display = 'block';
            } finally {
                submitBtn.disabled = false;
                loading.style.display = 'none';
            }
        });
    </script>
</body>
</html>