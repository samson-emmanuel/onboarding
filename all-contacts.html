<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>All Contacts | Onboarding Portal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'deep-green': '#006400',
            'light-green': '#008000',
            'text-green': '#2E8B57',
            'deep-red': '#8B0000',
          }
        }
      }
    }
  </script>
</head>
<body class="min-h-screen bg-gradient-to-br from-gray-100 via-gray-200 to-gray-300">

  <!-- Navbar -->
  <nav class="bg-gradient-to-r from-deep-green to-light-green shadow-xl">
    <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
      <a href="#" id="logoLink" class="flex items-center gap-3">
        <img src="images/lafarge-onboarding-app.png" alt="Onboarding Portal Logo" class="w-10 h-10">
        <span class="text-white font-bold text-xl">Onboarding Portal</span>
      </a>
      <button onclick="logout()" class="bg-deep-red hover:bg-deep-red text-white font-bold py-2.5 px-6 rounded-lg transition">
        Logout
      </button>
    </div>
  </nav>

  <!-- Header -->
  <header class="bg-gradient-to-r from-deep-green via-light-green to-green-700 shadow-2xl text-white py-16">
    <div class="max-w-7xl mx-auto px-6 text-center">
      <h1 class="text-4xl md:text-5xl font-extrabold mb-4">All Contacts Directory</h1>
      <p class="text-xl opacity-90">Emergency services, Lafarge team, embassies, and HR support</p>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    
    <div class="mb-10 max-w-2xl mx-auto">
        <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                </svg>
            </div>
            <input id="search" name="search" class="block w-full pl-12 pr-3 py-4 border border-gray-300 rounded-full leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-deep-green focus:border-deep-green sm:text-lg shadow-md" placeholder="Search all contacts..." type="search">
        </div>
    </div>

    <!-- Loading -->
    <div id="loading" class="text-center py-20">
      <div class="inline-flex items-center gap-4 text-deep-green">
        <div class="animate-spin rounded-full h-12 w-12 border-4 border-deep-green border-t-transparent"></div>
        <span class="text-2xl font-medium">Loading contacts...</span>
      </div>
    </div>

    <!-- Error -->
    <div id="error" class="hidden bg-red-100 border border-deep-red text-deep-red px-6 py-4 rounded-lg mb-8">
      <strong>Error:</strong> <span></span>
    </div>

    <!-- Emergency -->
    <div id="emergencySection" class="hidden mb-12">
      <div class="mb-6">
        <h2 class="text-3xl font-extrabold text-gray-900 border-b-2 border-red-200 pb-2">Emergency Services</h2>
      </div>
      <div id="emergencyGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
      <div id="emergencyNoData" class="text-center text-gray-500 py-12 text-lg hidden">
          No emergency information available.
      </div>
    </div>

    <!-- Lafarge -->
    <div id="lafargeSection" class="hidden mb-12">
      <div class="mb-6">
        <h2 class="text-3xl font-extrabold text-gray-900 border-b-2 border-green-200 pb-2">Lafarge Contacts</h2>
      </div>
      <div id="lafargeGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8"></div>
      <div id="lafargeNoData" class="text-center text-gray-500 py-12 text-lg hidden">
          No Lafarge contacts available.
      </div>
    </div>

    <!-- Coming Soon Sections -->
    <div id="embassiesSection" class="hidden bg-white rounded-2xl shadow-xl p-16 text-center mb-10">
      <div class="bg-gradient-to-r from-deep-green to-light-green text-white p-8 rounded-2xl">
        <h2 class="text-3xl font-bold">Embassies</h2>
        <p class="text-xl mt-4 opacity-90">Contact information coming soon</p>
      </div>
    </div>

    <!-- HR Section -->
    <div id="hrSection" class="hidden mb-12">
      <div class="mb-6">
        <h2 class="text-3xl font-extrabold text-gray-900 border-b-2 border-blue-200 pb-2">HR Contacts</h2>
      </div>
      <div id="hrGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8"></div>
      <div id="hrNoData" class="text-center text-gray-500 py-12 text-lg hidden">
          No HR contacts available.
      </div>
    </div>

    <!-- Coming Soon Sections -->
    <div id="embassiesSection" class="hidden bg-white rounded-2xl shadow-xl p-16 text-center mb-10">
      <div class="bg-gradient-to-r from-deep-green to-light-green text-white p-8 rounded-2xl">
        <h2 class="text-3xl font-bold">Embassies</h2>
        <p class="text-xl mt-4 opacity-90">Contact information coming soon</p>
      </div>
    </div>

  </main>

  <script>
    let allContactsData = {};
    
    const userStr = localStorage.getItem('user');
    if (!userStr) {
        window.location.href = 'index.html';
    } else {
        try { JSON.parse(userStr); } 
        catch (e) {
            localStorage.removeItem('user');
            window.location.href = 'index.html';
        }
    }

    async function getAllContacts() {
        const mockResponse = {
            "message": "Request Successful",
            "result": {
                "emergency": [],
                "lafarge": [
                    { "function": "Country Security Manager", "name": "Saidi Faragi Ahmed", "phone": "0707 471 7984" },
                    { "function": "Deputy Country Security Manager", "name": "Clement Omosola Babatunde", "phone": "0803 788 2702" },
                    { "function": "Ashaka Security Manager", "name": "Akintayo Adedeji", "phone": "0806 427 1988" },
                    { "function": "Ewekoro Security Manager", "name": "Clement Omosola", "phone": "0803 788 2702" },
                    { "function": "Mfamosing Security Manager", "name": "Wale Adegoke", "phone": "0802 222 4331" },
                    { "function": "Sagamu Security Manager", "name": "Clement Omosola Babatunde", "phone": "0803 788 2702" },
                    { "function": "Admin Manager - Security", "name": "Sola Akinboboye", "phone": "0812 717 8749" },
                    { "function": "Country Health & Safety Manager", "name": "Rachael Ezembakwe", "phone": "0807 079 2980" },
                    { "function": "Occupational Health Coordinator", "name": "Dr Chimaobi Okoronkwo", "phone": "0812 792 5856" },
                    { "function": "Human Resources & Org. Director", "name": "Gbemiga Owolabi", "phone": "0813 356 9318" },
                    { "function": "Head of Corporate Communications", "name": "Ginika Frank-Durugbor", "phone": "0812 792 5501" },
                    { "function": "Head of Corporate Services", "name": "Aragho Jemine Michael", "phone": "0707 470 8363" },
                    { "function": "Office Manager to the Country CEO", "name": "Oluwabusayomi Opayemi", "phone": "0808 806 8669" }
                ],
                "embassies": [],
                "hr": [
                    { "name": "Azeez-Enilolobo Mosunmola", "designation": "", "email": "mosun.azeez-enilolobo@lafarge.com" },
                    { "name": "AKPATA, ADERONKE EKONG", "designation": "", "email": "ADERONKE.AKPATA@LAFARGE.COM" },
                    { "name": "ABUBAKAR, AHMED TIJJANI", "designation": "", "email": "TIJANI.AHMED@LAFARGE.COM" },
                    { "name": "OBASANYA, EZEKIEL OLUSANJO", "designation": "", "email": "EZEKIEL.OBASANYA@LAFARGE.COM" },
                    { "name": "ITA, BARONG-BESONG ERNEST", "designation": "", "email": "BARONG.ITA@LAFARGE.COM" },
                    { "name": "EBADAN, PHILLIAN AKHERE", "designation": "", "email": "PHILLIAN.EBADAN@LAFARGE.COM" },
                    { "name": "ABDUL, HASSAN", "designation": "", "email": "HASSAN.ABDU@LAFARGE.COM" },
                    { "name": "WAHID, AKIM", "designation": "", "email": "WAHID.AKIM@LAFARGE.COM" },
                    { "name": "ATANARUNO, DANIEL", "designation": "", "email": "DANIEL.ATANARUNO@LAFARGE.COM" },
                    { "name": "OMOWORARE, OLABODE EDWARD", "designation": "", "email": "BODE.OMOWORARE@LAFARGE.COM" },
                    { "name": "CHUKWUKA MADUBUIKE", "designation": "", "email": "CHUKWUKA.MADUBUIKE@LAFARGE.COM" },
                    { "name": "Owolabi, Olugbemiga Ayoyimika", "designation": "Organization & Human Resources Director", "email": "Gbemiga.Owolabi@Lafarge.Com" },
                    { "name": "Edun, Oluwole Adedayo", "designation": "Head Hr - Industrial/Ir", "email": "Oluwole.Edun@Lafarge.Com" },
                    { "name": "Bede-Nwokoye, Ugochi Dawn", "designation": "Head - Talent Management/Od", "email": "Ugochi.Bede-Nwokoye@Lafarge.Com" },
                    { "name": "Shokunbi, Micheal Atanda", "designation": "Head - Industrial Learning & Development", "email": "Michael.Shokunbi@Lafarge.Com" },
                    { "name": "Aragho, Jemine Michael", "designation": "Head - Corporate Services", "email": "Jemine.Aragho@Lafarge.Com" },
                    { "name": "Azeez-Enilolobo, Mosunmola", "designation": "Head Hr - Other Functions", "email": "Mosun.Azeez-Enilolobo@Lafarge.Com" },
                    { "name": "Yisau, Bunmi Muinat", "designation": "", "email": "" },
                    { "name": "Ushie, Gloria Temitope", "designation": "", "email": "" },
                    { "name": "Akpata, Aderonke Ekong", "designation": "", "email": "" },
                    { "name": "Abubakar, Ahmed Tijjani", "designation": "", "email": "" },
                    { "name": "Obasanya, Ezekiel Olusanjo", "designation": "", "email": "" },
                    { "name": "Ita, Barong-Besong Ernest", "designation": "", "email": "" },
                    { "name": "Ebadan, Phillian Akhere", "designation": "", "email": "" },
                    { "name": "Abdul, Hassan", "designation": "", "email": "" },
                    { "name": "Wahid, Akim", "designation": "", "email": "" },
                    { "name": "Atanaruno, Daniel", "designation": "", "email": "" },
                    { "name": "Omoworare, Olabode Edward", "designation": "", "email": "" }
                ]
            },
            "statusCode": "200",
            "isSuccessful": true
        };
        return Promise.resolve(mockResponse.result);
    }

    function renderEmergency(emergency) {
        const grid = document.getElementById('emergencyGrid');
        const noData = document.getElementById('emergencyNoData');
        const section = document.getElementById('emergencySection');
        
        grid.innerHTML = '';
        section.style.display = 'block';

        if (!emergency || emergency.length === 0) {
            noData.style.display = 'block';
            grid.style.display = 'none';
            return;
        }

        noData.style.display = 'none';
        grid.style.display = 'grid';
        emergency.forEach(item => {
            const card = document.createElement('div');
            card.className = 'contact-card bg-white rounded-2xl shadow-lg overflow-hidden border-2 border-red-100 hover:border-red-300 transition-all duration-300';
            card.innerHTML = `
                <div class="p-6">
                    <div class="flex items-center space-x-4">
                        <div class="flex-shrink-0">
                            <div class="h-14 w-14 rounded-full bg-red-100 flex items-center justify-center">
                               <svg class="w-8 h-8 text-deep-red" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                </svg>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-lg font-bold text-gray-900 truncate" data-searchable>${item.service}</p>
                            <p class="text-sm text-gray-600 truncate">${item.info || ''}</p>
                        </div>
                    </div>
                </div>
            `;
            grid.appendChild(card);
        });
    }

    function renderLafarge(lafarge) {
        const grid = document.getElementById('lafargeGrid');
        const noData = document.getElementById('lafargeNoData');
        const section = document.getElementById('lafargeSection');
        
        grid.innerHTML = '';
        section.style.display = 'block';

        if (!lafarge || lafarge.length === 0) {
            noData.style.display = 'block';
            grid.style.display = 'none';
            return;
        }
        
        noData.style.display = 'none';
        grid.style.display = 'grid';
        lafarge.forEach(contact => {
            const card = document.createElement('div');
            card.className = "contact-card bg-white rounded-2xl shadow-lg overflow-hidden transform hover:-translate-y-2 transition-transform duration-300 ease-in-out border border-gray-100";
            card.innerHTML = `
                <div class="p-6">
                    <div class="flex items-center space-x-4">
                        <div class="flex-shrink-0">
                            <div class="h-14 w-14 rounded-full bg-gradient-to-br from-light-green to-deep-green flex items-center justify-center text-white text-xl font-bold">
                                ${contact.name.charAt(0).toUpperCase()}
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-lg font-bold text-gray-900 truncate" data-searchable>${contact.name}</p>
                            <p class="text-sm text-gray-500 truncate">${contact.function || 'No function specified'}</p>
                        </div>
                    </div>
                    ${contact.phone ? `
                    <div class="mt-5">
                        <a href="tel:${contact.phone.replace(/\D/g, '')}" class="flex items-center text-sm text-gray-700 hover:text-deep-green group">
                            <svg class="h-5 w-5 text-gray-400 group-hover:text-deep-green mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg>
                            <span>${contact.phone}</span>
                        </a>
                    </div>` : ''}
                </div>
            `;
            grid.appendChild(card);
        });
    }

    function renderHr(hr) {
        const grid = document.getElementById('hrGrid');
        const noData = document.getElementById('hrNoData');
        const section = document.getElementById('hrSection');
        
        grid.innerHTML = '';
        section.style.display = 'block';

        const validContacts = hr.filter(c => c.name?.trim());
        if (validContacts.length === 0) {
            noData.style.display = 'block';
            grid.style.display = 'none';
            return;
        }
        
        noData.style.display = 'none';
        grid.style.display = 'grid';
        validContacts.forEach(contact => {
            const card = document.createElement('div');
            card.className = "contact-card bg-white rounded-2xl shadow-lg overflow-hidden transform hover:-translate-y-2 transition-transform duration-300 ease-in-out border border-gray-100";
            card.innerHTML = `
                <div class="p-6">
                    <div class="flex items-center space-x-4">
                        <div class="flex-shrink-0">
                            <div class="h-14 w-14 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white text-xl font-bold">
                                ${contact.name.charAt(0).toUpperCase()}
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-lg font-bold text-gray-900 truncate" data-searchable>${contact.name}</p>
                            <p class="text-sm text-gray-500 truncate">${contact.designation || 'No designation'}</p>
                        </div>
                    </div>
                    ${contact.email ? `
                    <div class="mt-5">
                        <a href="mailto:${contact.email}" class="flex items-center text-sm text-gray-700 hover:text-deep-green group">
                            <svg class="h-5 w-5 text-gray-400 group-hover:text-deep-green mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                            <span>${contact.email}</span>
                        </a>
                    </div>` : ''}
                </div>
            `;
            grid.appendChild(card);
        });
    }
    
    function setupSearch(fullContacts) {
        const searchInput = document.getElementById('search');
        searchInput.addEventListener('input', () => {
            const searchTerm = searchInput.value.toLowerCase();
            
            const filteredEmergency = (fullContacts.emergency || []).filter(c => 
                c.service?.toLowerCase().includes(searchTerm) ||
                c.info?.toLowerCase().includes(searchTerm)
            );
            renderEmergency(filteredEmergency);

            const filteredLafarge = (fullContacts.lafarge || []).filter(c => 
                c.name?.toLowerCase().includes(searchTerm) ||
                c.function?.toLowerCase().includes(searchTerm)
            );
            renderLafarge(filteredLafarge);
            
            const filteredHr = (fullContacts.hr || []).filter(c => 
                c.name?.toLowerCase().includes(searchTerm) ||
                c.designation?.toLowerCase().includes(searchTerm)
            );
            renderHr(filteredHr);
        });
    }

    function renderEmptySections() {
        if (!allContactsData.embassies || allContactsData.embassies.length === 0) {
            document.getElementById('embassiesSection').style.display = 'block';
        }
    }

    function showError(message) {
        document.getElementById('loading').style.display = 'none';
        const errorDiv = document.getElementById('error');
        errorDiv.querySelector('span').textContent = message;
        errorDiv.style.display = 'block';
    }

    function logout() {
        localStorage.clear();
        window.location.href = 'index.html';
    }

    function setLogoLink() {
        const logoLink = document.getElementById('logoLink');
        if (!logoLink) return;
        let userRole = '';
        try {
            userRole = JSON.parse(localStorage.getItem('user'))?.role;
        } catch (e) { /* ignore */ }
        logoLink.href = userRole ? `index-${userRole.toLowerCase().replace('_', '-')}.html` : 'index.html';
    }

    window.addEventListener('load', async () => {
        setLogoLink();
        try {
            allContactsData = await getAllContacts();
            renderEmergency(allContactsData.emergency);
            renderLafarge(allContactsData.lafarge);
            renderHr(allContactsData.hr);
            renderEmptySections();
            setupSearch(allContactsData);
        } catch (error) {
            showError(error.message);
        } finally {
            document.getElementById('loading').style.display = 'none';
        }
    });
  </script>
</body>
</html>