<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password - Onboarding Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
          theme: {
            extend: {
              colors: {
                'deep-green': '#006400',
                'light-green': '#008000',
                'text-green': '#2E8B57',
                'deep-red': '#8B0000',
              }
            }
          }
        }
      </script>
</head>
<body style="background-color: #000;">
    <header class="bg-gray-900 text-white text-center py-8 shadow-md">
        <h1 class="text-4xl font-light">Reset Password</h1>
        <p class="opacity-90 mt-2">Enter your details to reset your password</p>
    </header>

    <div class="container mx-auto mt-8 max-w-md">
        <div class="bg-gray-900 p-8 rounded-lg shadow-md">
            <form id="resetForm">
                <div class="mb-4">
                    <label for="email" class="block text-green-500 text-sm font-bold mb-2">Email Address</label>
                    <input type="email" id="email" placeholder="Enter your email" required class="shadow appearance-none border rounded w-full py-2 px-3 text-white leading-tight focus:outline-none focus:shadow-outline focus:ring-1 focus:ring-green-500 focus:border-green-500 bg-gray-800 border-gray-700">
                    <div class="text-deep-red mt-2 text-sm" id="emailError" style="display: none;"></div>
                </div>

                <div class="mb-4 relative">
                    <label for="newPassword" class="block text-green-500 text-sm font-bold mb-2">New Password</label>
                    <input type="password" id="newPassword" placeholder="Enter new password" required class="shadow appearance-none border rounded w-full py-2 px-3 text-white leading-tight focus:outline-none focus:shadow-outline pr-10 focus:ring-1 focus:ring-green-500 focus:border-green-500 bg-gray-800 border-gray-700">
                    <button type="button" id="toggleNewPassword" class="absolute inset-y-0 right-0 pr-3 flex items-center pt-6 text-sm leading-5">
                        <svg class="h-5 w-5 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path id="newEyeOpen" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            <path id="newEyeOpen2" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                            <path id="newEyeClosed" class="hidden" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.542-7 .993-3.111 3.568-5.613 6.643-6.915M2.458 12C3.732 7.943 7.523 5 12 5c.66 0 1.309.079 1.944.223M19.542 12c-.27-.803-.59-1.554-.95-2.247M12 5c.66 0 1.309.079 1.944.223M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.542-7 .993-3.111 3.568-5.613 6.643-6.915M2.458 12C3.732 7.943 7.523 5 12 5c.66 0 1.309.079 1.944.223M19.542 12c-.27-.803-.59-1.554-.95-2.247L12 12l.75.75L15 12m-6 0a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                    </button>
                    <div class="text-deep-red mt-2 text-sm" id="newPasswordError" style="display: none;"></div>
                </div>

                <div class="mb-4 relative">
                    <label for="confirmPassword" class="block text-green-500 text-sm font-bold mb-2">Confirm New Password</label>
                    <input type="password" id="confirmPassword" placeholder="Confirm new password" required class="shadow appearance-none border rounded w-full py-2 px-3 text-white leading-tight focus:outline-none focus:shadow-outline pr-10 focus:ring-1 focus:ring-green-500 focus:border-green-500 bg-gray-800 border-gray-700">
                    <button type="button" id="toggleConfirmPassword" class="absolute inset-y-0 right-0 pr-3 flex items-center pt-6 text-sm leading-5">
                        <svg class="h-5 w-5 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path id="confirmEyeOpen" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            <path id="confirmEyeOpen2" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                            <path id="confirmEyeClosed" class="hidden" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.542-7 .993-3.111 3.568-5.613 6.643-6.915M2.458 12C3.732 7.943 7.523 5 12 5c.66 0 1.309.079 1.944.223M19.542 12c-.27-.803-.59-1.554-.95-2.247M12 5c.66 0 1.309.079 1.944.223M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.542-7 .993-3.111 3.568-5.613 6.643-6.915M2.458 12C3.732 7.943 7.523 5 12 5c.66 0 1.309.079 1.944.223M19.542 12c-.27-.803-.59-1.554-.95-2.247L12 12l.75.75L15 12m-6 0a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                    </button>
                    <div class="text-deep-red mt-2 text-sm" id="confirmPasswordError" style="display: none;"></div>
                </div>

                <button type="submit" id="submitBtn" class="w-full bg-deep-green hover:bg-light-green text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">Reset Password</button>
            </form>

            <div id="loading" class="text-center mt-4 text-green-500" style="display: none;">Resetting password...</div>
            <div id="globalError" class="text-deep-red mt-4 text-sm" style="display: none;"></div>
            <div id="globalSuccess" class="text-light-green mt-4 text-sm" style="display: none;"></div>

            <a href="index.html" class="block text-center mt-4 text-green-500 hover:text-green-400">‚Üê Back to Login</a>
        </div>
    </div>

    <script>
        // Inline resetPassword function
        async function resetPassword(email, password) {
            const baseUrl = 'https://onboardingservice-812204315267.europe-west1.run.app/api';
            const url = `${baseUrl}/Auth/reset-password`;
            const headers = { 'accept': 'text/plain', 'Content-Type': 'application/json' };
            const body = JSON.stringify({ email, password });
            console.log('Reset password payload:', body);

            try {
                const response = await fetch(url, { method: 'POST', headers, body });
                if (response.status !== 200) {
                    throw new Error(`Failed to reset password: ${response.status}. ${await response.text()}`);
                }
                return await response.json();
            } catch (e) {
                throw new Error(`Network error during reset password request: ${e.message}`);
            }
        }

        // Handle form submission
        document.getElementById('resetForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const submitBtn = document.getElementById('submitBtn');
            const loading = document.getElementById('loading');
            const globalError = document.getElementById('globalError');
            const globalSuccess = document.getElementById('globalSuccess');

            // Clear previous messages
            globalError.style.display = 'none';
            globalSuccess.style.display = 'none';
            document.querySelectorAll('.error').forEach(el => el.style.display = 'none');

            const email = document.getElementById('email').value.trim();
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            // Basic validation
            if (!email || !newPassword || !confirmPassword) {
                globalError.textContent = 'Please fill in all required fields.';
                globalError.style.display = 'block';
                return;
            }

            if (newPassword !== confirmPassword) {
                document.getElementById('confirmPasswordError').textContent = 'Passwords do not match.';
                document.getElementById('confirmPasswordError').style.display = 'block';
                return;
            }

            if (newPassword.length < 6) {
                document.getElementById('newPasswordError').textContent = 'Password must be at least 6 characters long.';
                document.getElementById('newPasswordError').style.display = 'block';
                return;
            }

            // Disable button and show loading
            submitBtn.disabled = true;
            loading.style.display = 'block';

            try {
                const response = await resetPassword(email, newPassword);
                globalSuccess.textContent = 'Password reset successfully! You can now log in.';
                globalSuccess.style.display = 'block';
                document.getElementById('resetForm').reset();
            } catch (err) {
                globalError.textContent = err.message;
                globalError.style.display = 'block';
            } finally {
                submitBtn.disabled = false;
                loading.style.display = 'none';
            }
        });

        // Password toggle functionality for New Password
        const toggleNewPassword = document.getElementById('toggleNewPassword');
        const newPasswordInput = document.getElementById('newPassword');
        const newEyeOpen = document.getElementById('newEyeOpen');
        const newEyeOpen2 = document.getElementById('newEyeOpen2');
        const newEyeClosed = document.getElementById('newEyeClosed');

        toggleNewPassword.addEventListener('click', function() {
            const type = newPasswordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            newPasswordInput.setAttribute('type', type);
            newEyeOpen.classList.toggle('hidden');
            newEyeOpen2.classList.toggle('hidden');
            newEyeClosed.classList.toggle('hidden');
        });

        // Password toggle functionality for Confirm New Password
        const toggleConfirmPassword = document.getElementById('toggleConfirmPassword');
        const confirmPasswordInput = document.getElementById('confirmPassword');
        const confirmEyeOpen = document.getElementById('confirmEyeOpen');
        const confirmEyeOpen2 = document.getElementById('confirmEyeOpen2');
        const confirmEyeClosed = document.getElementById('confirmEyeClosed');

        toggleConfirmPassword.addEventListener('click', function() {
            const type = confirmPasswordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            confirmPasswordInput.setAttribute('type', type);
            confirmEyeOpen.classList.toggle('hidden');
            confirmEyeOpen2.classList.toggle('hidden');
            confirmEyeClosed.classList.toggle('hidden');
        });
    </script>
</body>
</html>